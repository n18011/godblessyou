# 開発ルール

## 1. ブランチ戦略

### ブランチ命名規則
- フィーチャーブランチ: `feature/{phase番号}-{機能名}`
  - 例: `feature/phase1-k8s-infra`
- バグ修正ブランチ: `fix/{issue番号}-{修正内容}`
  - 例: `fix/123-nginx-config`
- リリースブランチ: `release/v{メジャー}.{マイナー}.{パッチ}`
  - 例: `release/v1.0.0`

### ブランチワークフロー
1. 新機能開発時は`main`ブランチから新しいフィーチャーブランチを作成 ※リモート`main`の最新を取得すること
2. 作業完了後、プルリクエストを作成
3. レビュー後、`main`ブランチにマージ

## 2. コミットメッセージ規則

### コミットメッセージの形式
```
{type}: {概要}

- 詳細な変更点1
- 詳細な変更点2
```

### コミットタイプ
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメントのみの変更
- `style`: コードの意味に影響を与えない変更（空白、フォーマット等）
- `refactor`: リファクタリング
- `test`: テストコードの追加・修正
- `chore`: ビルドプロセスやツールの変更

## 3. プルリクエスト規則

### プルリクエストの形式
```
## 概要
{変更の目的と概要を記載}

## 変更内容
- 変更点1
- 変更点2

## 動作確認
- 確認項目1
- 確認項目2

## 関連Issue
Closes #{issue番号}

## 次のステップ
1. 次のタスク1
2. 次のタスク2
```

## 4. Kubernetes関連の規則

### マニフェストファイルの配置
```
k8s/
├── clusters/              # クラスター固有の設定
│   └── kind-config.yaml   # Kindクラスター設定
├── base/                  # 共通のベース設定
│   ├── namespaces/       # 名前空間定義
│   ├── storage/          # ストレージ関連
│   └── networking/       # ネットワーク関連
└── overlays/             # 環境固有のオーバーレイ設定
    ├── development/      # 開発環境
    └── production/       # 本番環境
```

### リソース命名規則
- 小文字とハイフンを使用
- プレフィックスに機能名やコンポーネント名を付与
- 例: `nginx-ingress-controller`, `mysql-persistent-volume`

### ラベル付与規則
必須ラベル：
- `app.kubernetes.io/name`: アプリケーション名
- `app.kubernetes.io/component`: コンポーネントの種類
- `app.kubernetes.io/part-of`: 所属するシステム名
- `app.kubernetes.io/managed-by`: 管理ツール名

## 5. ドキュメント規則

### ドキュメントの配置
```
docs/
├── rules/              # 各種ルール
├── architecture/       # アーキテクチャ設計
├── operations/        # 運用手順
└── development/       # 開発ガイド
```

### READMEの必須項目
- プロジェクト概要
- 前提条件
- セットアップ手順
- 開発フロー
- 貢献ガイド
- ライセンス

## 6. レビュー規則

### レビュー観点
1. 機能要件
   - 仕様通りに実装されているか
   - エッジケースが考慮されているか

2. 非機能要件
   - パフォーマンスへの影響
   - セキュリティ上の問題
   - 運用性への影響

3. コード品質
   - 命名の適切さ
   - コードの重複
   - エラーハンドリング
   - テストの網羅性

### レビューコメント規則
- 建設的なフィードバックを心がける
- 具体的な改善案を提示する
- 必須の修正は「Must」、推奨の修正は「Should」と明記

## 7. 作業手順規則

### 開発作業の流れ
1. Issue確認
   - Issue内容の理解
   - 技術要件の確認
   - 受け入れ基準の確認

2. ブランチ作成
   - 命名規則に従ったブランチ名の決定
   - `main`ブランチからの新規ブランチ作成

3. 実装
   - 必要なディレクトリ構造の作成
   - 設定ファイルの作成
   - コードの実装

4. 動作確認
   - 基本機能の確認
   - エッジケースの確認
   - パフォーマンスの確認
   - セキュリティの確認

5. コミット
   - コミットメッセージ規則に従ったコミット
   - 適切な粒度でのコミット

6. プルリクエスト作成
   - プルリクエスト形式に従った記述
   - 関連Issueの紐付け
   - 動作確認結果の記載
   - 次のステップの明確化

### 動作確認項目
1. クラスターの基本機能
   - APIサーバーの状態確認
   - コアコンポーネントの状態確認

2. ノードの状態
   - ノードのReadiness確認
   - ラベルとアノテーションの確認
   - リソース割り当ての確認

3. ネットワーク
   - DNS解決の確認
   - サービス間通信の確認
   - 外部アクセスの確認

4. ストレージ
   - StorageClassの確認
   - PersistentVolumeの確認
   - データの永続化確認

5. セキュリティ
   - RBAC設定の確認
   - ネットワークポリシーの確認
   - シークレット管理の確認

### トラブルシューティング手順
1. 問題の切り分け
   - ログの確認
   - イベントの確認
   - リソース状態の確認

2. 原因の特定
   - エラーメッセージの解析
   - 設定値の確認
   - 依存関係の確認

3. 解決策の実施
   - 設定の修正
   - リソースの再作成
   - 依存関係の修正

4. 再発防止
   - ドキュメントの更新
   - 監視の強化
   - 自動テストの追加